/*
 * FilePondPluginImagePreview 4.0.3
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginImagePreview=t()}(this,function(){"use strict";var o={type:"spring",stiffness:.5,damping:.45,mass:10},I=function(e,t){return{x:e,y:t}},c=function(e,t){return I(e.x-t.x,e.y-t.y)},m=function(e,t){return Math.sqrt((r=c(i=e,a=t),n=c(i,a),r.x*n.x+r.y*n.y));var i,a,r,n},v=function(e,t){var i=e,a=t,r=1.5707963267948966-t,n=Math.sin(1.5707963267948966),o=Math.sin(a),c=Math.sin(r),s=Math.cos(r),l=i/n;return I(s*(l*o),s*(l*c))},w=function(e,t,i,a){var r,n,o,c,s,l,h,f,p,u=.5<a.x?1-a.x:a.x,d=.5<a.y?1-a.y:a.y,E=2*u*e.width,g=2*d*e.height,_=(n=i,o=(r=t).width,c=r.height,s=v(o,n),l=v(c,n),h=I(r.x+Math.abs(s.x),r.y-Math.abs(s.y)),f=I(r.x+r.width+Math.abs(l.y),r.y+Math.abs(l.x)),p=I(r.x-Math.abs(l.y),r.y+r.height-Math.abs(l.x)),{width:m(h,f),height:m(h,p)});return Math.max(_.width/E,_.height/g)},s=function(e){return e.utils.createView({name:"image-bitmap",tag:"canvas",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function(e){var t,i,a=e.root,r=e.props;t=r.image,(i=(i=a.element)||document.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)}})},r=function(n){return n.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(e){var a,t=e.root,i=e.props;t.ref.image=t.appendChildView(t.createChildView((a=n).utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:o,originY:o,scaleX:o,scaleY:o,translateX:o,translateY:o,rotateZ:o}},create:function(e){var t=e.root,i=e.props;i.width=i.image.width,i.height=i.image.height,t.ref.image=t.appendChildView(t.createChildView(s(a),{image:i.image}))},write:function(e){var t=e.root,i=e.props.crop.flip,a=t.ref.image;a.scaleX=i.horizontal?-1:1,a.scaleY=i.vertical?-1:1}}),Object.assign({},i)));var r=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==r&&(t.element.dataset.transparencyIndicator="grid"===r?r:"color")},write:function(e){var t=e.root,i=e.props,a=e.shouldOptimize,r=i.crop,n=i.width,o=i.height;t.ref.image.crop=r;var c,s,l,h,f={x:0,y:0,width:n,height:o,center:{x:.5*n,y:.5*o}},p={width:t.ref.image.width,height:t.ref.image.height},u={x:r.center.x*p.width,y:r.center.y*p.height},d={x:f.center.x-p.width*r.center.x,y:f.center.y-p.height*r.center.y},E=2*Math.PI+r.rotation%(2*Math.PI),g=r.aspectRatio||p.height/p.width,_=w(p,(l=(c=f).width,(h=l*(s=g))>c.height&&(l=(h=c.height)/s),{x:.5*(c.width-l),y:.5*(c.height-h),width:l,height:h}),E,r.center),I=r.zoom*_,m=t.ref.image;if(a)return m.originX=null,m.originY=null,m.translateX=null,m.translateY=null,m.rotateZ=null,m.scaleX=null,void(m.scaleY=null);m.originX=u.x,m.originY=u.y,m.translateX=d.x,m.translateY=d.y,m.rotateZ=E,m.scaleX=I,m.scaleY=I}})},n='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>',l=!1,h=0,f=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},p={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},_=function(e,t,i,a){-1!==a&&e.transform.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(p[a](t,i)))},y=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},T=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},u=function(c){var a,i=c.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,i=e.props;!l&&document.querySelector("base")&&(n=n.replace(/url\(\#/g,"url("+window.location.href.replace(window.location.hash,"")+"#"),l=!0),h++,t.element.classList.add("filepond--image-preview-overlay-"+i.status),t.element.innerHTML=n.replace(/__UID__/g,h)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),s=(a=c).utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["crop"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:o,scaleY:o,translateY:o,opacity:{type:"tween",duration:400}}},create:function(e){var t=e.root,i=e.props;t.ref.clip=t.appendChildView(t.createChildView(r(a),{image:i.image,crop:i.crop}))},write:function(e){var t=e.root,i=e.props,a=e.shouldOptimize,r=t.ref.clip,n=i.crop,o=i.image;if(r.crop=n,r.opacity=a?0:1,!a){var c=o.height/o.width,s=n.aspectRatio||c,l=t.rect.inner.width,h=t.rect.inner.height,f=t.query("GET_IMAGE_PREVIEW_HEIGHT"),p=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),u=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),d=t.query("GET_PANEL_ASPECT_RATIO"),E=t.query("GET_ALLOW_MULTIPLE");d&&!E&&(f=l*d,s=d);var g=null!==f?f:Math.max(p,Math.min(l*s,u)),_=g/s;l<_&&(g=(_=l)*s),h<g&&(_=(g=h)/s),r.width=_,r.height=g}}}),g=function(e){var t=e.root,i=e.props,a=i.id,r=t.query("GET_ITEM",{id:a});if(r){var n=i.preview,o=r.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},c=t.appendChildView(t.createChildView(s,{image:n,crop:o,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),t.childViews.length);t.ref.images.push(c),c.opacity=1,c.scaleX=1,c.scaleY=1,c.translateY=0,setTimeout(function(){t.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:a})},250)}},e=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},t=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return c.utils.createView({name:"image-preview-wrapper",create:function(e){var t=e.root;t.ref.images=[],t.ref.imageViewBin=[],t.ref.overlayShadow=t.appendChildView(t.createChildView(i,{opacity:0,status:"idle"})),t.ref.overlaySuccess=t.appendChildView(t.createChildView(i,{opacity:0,status:"success"})),t.ref.overlayError=t.appendChildView(t.createChildView(i,{opacity:0,status:"failure"}))},styles:["height"],apis:["height"],write:c.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:function(e){var t=e.root,i=t.ref.images[t.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:function(e){var i=e.root,a=e.props.id,t=i.query("GET_ITEM",a);if(t){var r,n,o,c=URL.createObjectURL(t.file);r=c,n=function(e,t){i.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:a,width:e,height:t})},(o=new Image).onload=function(){var e=o.naturalWidth,t=o.naturalHeight;o=null,n(e,t)},o.src=r}},DID_FINISH_CALCULATE_PREVIEWSIZE:function(e){var p=e.root,u=e.props,t=c.utils.createWorker,i=u.id,d=p.query("GET_ITEM",i);if(d){var a,E=URL.createObjectURL(d.file),r=function(){var a;(a=E,new Promise(function(e,t){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){e(i)},i.onerror=function(e){t(e)},i.src=a})).then(n)},n=function(e){URL.revokeObjectURL(E);var t=(d.getMetadata("exif")||{}).orientation||-1,i=e.width,a=e.height;if(5<=t&&t<=8){var r=[a,i];i=r[0],a=r[1]}var n=window.devicePixelRatio,o=a/i,c=p.rect.element.width,s=p.rect.element.height,l=0,h=0;h=(l=c)*o,1<o?h=(l=c)*o:l=(h=s)/o,u.preview=function(e,t,i,a){t=Math.round(t),i=Math.round(i);var r=document.createElement("canvas");r.width=t,r.height=i;var n=r.getContext("2d");if(5<=a&&a<=8){var o=[i,t];t=o[0],i=o[1]}return _(n,t,i,a),n.drawImage(e,0,0,t,i),r}(e,Math.min(i,l*n*4),Math.min(a,h*n*4),t);var f=p.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?function(e){var t=Math.min(10/e.width,10/e.height),i=document.createElement("canvas"),a=i.getContext("2d"),r=i.width=Math.ceil(e.width*t),n=i.height=Math.ceil(e.height*t);a.drawImage(e,0,0,r,n);var o=null;try{o=a.getImageData(0,0,r,n).data}catch(e){return null}for(var c=o.length,s=0,l=0,h=0,f=0;f<c;f+=4)s+=o[f]*o[f],l+=o[f+1]*o[f+1],h+=o[f+2]*o[f+2];return{r:s=T(s,c),g:l=T(l,c),b:h=T(h,c)}}(e):null;d.setMetadata("color",f,!0),"close"in e&&e.close(),p.ref.overlayShadow.opacity=1,g({root:p,props:u})};if(a=d.file,"createImageBitmap"in window&&y(a)){var o=t(f);o.post({file:d.file},function(e){o.terminate(),e?n(e):r()})}else r()}},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;if("crop"===e.action.change.key&&t.ref.images.length){var a=t.query("GET_ITEM",{id:i.id});if(a){var r,n,o,c,s,l,h=a.getMetadata("crop"),f=t.ref.images[t.ref.images.length-1];1e-5<Math.abs(h.aspectRatio-f.crop.aspectRatio)?((l=(s={root:t}.root).ref.images.shift()).opacity=0,l.translateY=-15,s.ref.imageViewBin.push(l),g({root:t,props:i})):(n=(r={root:t,props:i}).root,o=r.props,(c=n.query("GET_ITEM",{id:o.id}))&&(n.ref.images[n.ref.images.length-1].crop=c.getMetadata("crop")))}}},DID_THROW_ITEM_LOAD_ERROR:t,DID_THROW_ITEM_PROCESSING_ERROR:t,DID_THROW_ITEM_INVALID:t,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:e,DID_REVERT_ITEM_PROCESSING:e},function(e){var i=e.root,t=i.ref.imageViewBin.filter(function(e){return 0===e.opacity});i.ref.imageViewBin=i.ref.imageViewBin.filter(function(e){return 0<e.opacity}),t.forEach(function(e){return t=e,i.removeChildView(t),void t._destroy();var t}),t.length=0})})},e=function(e){var t=e.addFilter,i=e.utils,a=i.Type,n=i.createRoute,f=i.isFile,p=u(e);return t("CREATE_VIEW",function(e){var t=e.is,l=e.view,h=e.query;if(t("file")&&h("GET_ALLOW_IMAGE_PREVIEW")){var r=function(e,t){if(e.ref.imagePreview){var i=t.id,a=e.query("GET_ITEM",{id:i});if(a){var r=e.query("GET_PANEL_ASPECT_RATIO"),n=e.query("GET_ITEM_PANEL_ASPECT_RATIO"),o=e.query("GET_IMAGE_PREVIEW_HEIGHT");if(!(r||n||o)){var c=e.ref,s=c.imageWidth,l=c.imageHeight;if(s&&l){var h=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),f=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),p=(a.getMetadata("exif")||{}).orientation||-1;if(5<=p&&p<=8){var u=[l,s];s=u[0],l=u[1]}if(!y(a.file)){var d=2048/s;s*=d,l*=d}var E=l/s,g=(a.getMetadata("crop")||{}).aspectRatio||E,_=Math.max(h,Math.min(l,f)),I=e.rect.element.width,m=Math.min(I*g,_);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:a.id,height:m})}}}}},i=function(e){var t=e.root,i=e.props;r(t,i)};l.registerWriter(n({DID_RESIZE_ROOT:i,DID_STOP_RESIZE:i,DID_LOAD_ITEM:function(e){var t=e.root,i=e.props.id,a=h("GET_ITEM",i);if(a&&f(a.file)&&!a.archived){var r=a.file;if(/^image/.test(r.type)){var n="createImageBitmap"in(window||{}),o=h("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!(!n&&o&&r.size>o)){t.ref.imagePreview=l.appendChildView(l.createChildView(p,{id:i}));var c=t.query("GET_IMAGE_PREVIEW_HEIGHT");c&&t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:a.id,height:c});var s=!n&&r.size>h("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");t.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:i},s)}}}},DID_IMAGE_PREVIEW_CALCULATE_SIZE:function(e){var t=e.root,i=e.props,a=e.action;t.ref.imageWidth=a.width,t.ref.imageHeight=a.height,r(t,i),requestAnimationFrame(function(){t.dispatch("DID_FINISH_CALCULATE_PREVIEWSIZE")})},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;"crop"===e.action.change.key&&r(t,i)}}))}}),{options:{allowImagePreview:[!0,a.BOOLEAN],imagePreviewHeight:[null,a.INT],imagePreviewMinHeight:[44,a.INT],imagePreviewMaxHeight:[256,a.INT],imagePreviewMaxFileSize:[null,a.INT],imagePreviewMaxInstantPreviewFileSize:[1e6,a.INT],imagePreviewTransparencyIndicator:[null,a.STRING],imagePreviewCalculateAverageImageColor:[!1,a.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e})),e});